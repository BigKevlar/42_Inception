# SELECCIONAMOS IMAGEN A MONTAR SOBRE LA CUAL INSTALAREMOS EL BACKEND MARIADB.
FROM debian:bullseye

# SELECCIONAMOS LOS "ARGUMENTOS DE CONSTRUCCION" QUE SERVIRAN PARA INICIALIZAR LAS VARIABLES DE ENTORNO.
ARG MARIADB_NAME
ARG MARIADB_ROOT_PASS
ARG MARIADB_USER
ARG MARIADB_USER_PASS

ENV MARIADB_NAME=${MARIADB_NAME} \
    MARIADB_ROOT_PASS=$MARIADB_ROOT_PASS \
    MARIADB_USER=${MARIADB_USER} \
    MARIADB_USER_PASS=${MARIADB_USER_PASS}

# UNA VEZ MONTADA LA IMAGEN DE DEBIAN, Y DENTRO DE ELLA, ACTUALIZAMOS E INSTALAMOS MARIADB.
RUN apt-get update && \
    apt-get install mariadb-server -y

# SUSTITUIMOS EL ARCHIVO DE CONFIGURACION DE MYSQL POR EL NUESTRO PERSONALIZADO.
COPY ./my.cnf /etc/mysql/my.cnf

# HACEMOS LO MISMO CON EL ARCHIVO DE INICIALIZACION DE LA BASE DE DATOS (ENTRYPOINT).
COPY ./init_db.sh /docker-entrypoint-initdb.d/init_db.sh

#   - CREAMOS DIRECTORIO PARA MARIADB.
#   - CAMBIAMOS EL PROPIETARIO PARA QUE MYSQL TENGA PERMISOS EN MARIADB. (o cambiamos permisos??????)
RUN chmod 777 -R /docker-entrypoint-initdb.d/init_db.sh && \
    chmod 777 -R /var/lib/mysql && \
    mkdir -p /var/run/mysqld/ && \
    chmod 777 -R /var/run/mysqld/

# EXPONEMOS EL PUERTO ESTANDAR DE MARIADB.
EXPOSE 3306

# DEFINIMOS EL COMANDO PARA INICIAR MARIADB.
CMD ["mysqld"]